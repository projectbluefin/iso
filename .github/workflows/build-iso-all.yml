---
name: Build All ISOs
# Orchestrator workflow that calls ALL individual ISO build workflows
# Builds ALL production ISOs with production tags only
#
# For testing tags (-testing), use individual variant workflows:
#   - build-iso-lts.yml → select lts-testing
#   - build-iso-lts-hwe.yml → select lts-hwe-testing
#
# Total: 8 production ISOs across all variants:
#   - build-iso-stable   → 2 Stable ISOs (amd64 × main, amd64 × nvidia-open)
#   - build-iso-lts      → 4 LTS ISOs (amd64/arm64 × main, amd64/arm64 × gdx)
#   - build-iso-lts-hwe  → 2 LTS-HWE ISOs (amd64/arm64 × main)
on:
  workflow_dispatch:
    inputs:
      upload_artifacts:
        description: 'Upload ISOs as job artifacts'
        type: boolean
        default: false
      upload_r2:
        description: 'Upload ISOs to Cloudflare R2'
        type: boolean
        default: true
  schedule:
    - cron: "0 3 * * TUE" # Push to testing bucket every week at 03:00 on Tuesdays - 2h after Bluefin publishes weekly builds.

jobs:
  build-iso-lts:
    name: Build LTS ISOs
    uses: ./.github/workflows/reusable-build-iso-anaconda.yml
    secrets: inherit
    with:
      image_version: lts  # Strictly LTS only
      image_tag: ${{ github.event_name == 'workflow_dispatch' && inputs.image_tag || 'lts' }}
      upload_artifacts: ${{ github.event_name == 'workflow_dispatch' && inputs.upload_artifacts || false }}
      upload_r2: ${{ github.event_name == 'workflow_dispatch' && inputs.upload_r2 || true }}

  build-iso-lts-hwe:
    name: Build LTS-HWE ISOs
    uses: ./.github/workflows/reusable-build-iso-anaconda.yml
    secrets: inherit
    with:
      image_version: lts-hwe  # Strictly LTS-HWE only
      image_tag: lts-hwe
      upload_artifacts: ${{ github.event_name == 'workflow_dispatch' && inputs.upload_artifacts || false }}
      upload_r2: ${{ github.event_name == 'workflow_dispatch' && inputs.upload_r2 || true }}

  build-iso-stable:
    name: Build Stable ISOs
    uses: ./.github/workflows/reusable-build-iso-anaconda.yml
    secrets: inherit
    with:
      image_version: stable  # Strictly Stable only
      image_tag: stable
      upload_artifacts: ${{ github.event_name == 'workflow_dispatch' && inputs.upload_artifacts || false }}
      upload_r2: ${{ github.event_name == 'workflow_dispatch' && inputs.upload_r2 || true }}
